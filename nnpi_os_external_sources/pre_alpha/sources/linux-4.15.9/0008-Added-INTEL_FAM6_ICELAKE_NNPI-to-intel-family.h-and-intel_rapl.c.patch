From f50149577a20fe4c21eb1dc7c322a3bf684beb79 Mon Sep 17 00:00:00 2001
From: Gil Montag <gil.montag@intel.com>
Date: Tue, 16 Apr 2019 14:19:56 +0300
Subject: [PATCH] Added INTEL_FAM6_ICELAKE_NNPI to intel-family.h and to
 intel_rapl.c   * Definitions taken from kernel 5.1rc3 (intel_OTC)

---
 arch/x86/include/asm/intel-family.h | 2 ++
 drivers/powercap/intel_rapl.c       | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/arch/x86/include/asm/intel-family.h b/arch/x86/include/asm/intel-family.h
index 35a6bc4da..3fd5c6f41 100644
--- a/arch/x86/include/asm/intel-family.h
+++ b/arch/x86/include/asm/intel-family.h
@@ -49,6 +49,8 @@
 #define INTEL_FAM6_KABYLAKE_MOBILE	0x8E
 #define INTEL_FAM6_KABYLAKE_DESKTOP	0x9E
 
+#define INTEL_FAM6_ICELAKE_NNPI		0x9D /* Icelake Neural NW processor */
+
 /* "Small Core" Processors (Atom) */
 
 #define INTEL_FAM6_ATOM_PINEVIEW	0x1C
diff --git a/drivers/powercap/intel_rapl.c b/drivers/powercap/intel_rapl.c
index d1694f1de..c382bb46d 100644
--- a/drivers/powercap/intel_rapl.c
+++ b/drivers/powercap/intel_rapl.c
@@ -1168,9 +1168,11 @@ static const struct x86_cpu_id rapl_ids[] __initconst = {
 	RAPL_CPU(INTEL_FAM6_ATOM_GOLDMONT,	rapl_defaults_core),
 	RAPL_CPU(INTEL_FAM6_ATOM_GEMINI_LAKE,	rapl_defaults_core),
 	RAPL_CPU(INTEL_FAM6_ATOM_DENVERTON,	rapl_defaults_core),
+	RAPL_CPU(INTEL_FAM6_ICELAKE_NNPI, 	rapl_defaults_core),
 
 	RAPL_CPU(INTEL_FAM6_XEON_PHI_KNL,	rapl_defaults_hsw_server),
 	RAPL_CPU(INTEL_FAM6_XEON_PHI_KNM,	rapl_defaults_hsw_server),
+
 	{}
 };
 MODULE_DEVICE_TABLE(x86cpu, rapl_ids);
-- 
2.17.1

